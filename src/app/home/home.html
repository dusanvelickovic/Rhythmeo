<!-- Loading indicator -->
@if (isLoading()) {
    <div class="w-full mx-auto min-h-auto text-white absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center">
        <div class="flex flex-col items-center space-y-4">
            <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-emerald-500"></div>
            <p class="text-gray-400 text-lg">Loading...</p>
        </div>
    </div>
}

<!-- Tracks swiper -->
@if (!isLoading()) {
    <div class="w-full mx-auto min-h-auto absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 px-4 sm:px-0">
        <div class="relative">
            <swiper-container
                #swiperContainer
                loop="true"
                navigation="false"
                slides-per-view="1"
                space-between="20"
                breakpoints='{"640": {"slidesPerView": 2}, "768": {"slidesPerView": 3}, "1024": {"slidesPerView": 5}, "1280": {"slidesPerView": 7}}'
            >
                @for (track of tracks(); track track.id) {
                    <swiper-slide>
                        <div class="flex flex-col items-center justify-between space-y-1 overflow-hidden">
                            <div class="relative w-full">
                                <img
                                    (click)="openTrackModal(track)"
                                    src="{{ track.album.images.at(0)?.url }}"
                                    class="w-full h-auto aspect-square max-h-64 rounded-lg border border-emerald-950 shadow shadow-black cursor-pointer object-cover"
                                />
                                <div class="absolute inset-0 rounded-lg bg-gray-700 mix-blend-overlay pointer-events-none"></div>
                            </div>
                            <div class="w-full max-w-64">
                                <div>
                                    <h2 class="text-white text-sm sm:text-base w-full text-center tracking-wide uppercase font-medium whitespace-nowrap overflow-hidden text-ellipsis">{{ track.name }}</h2>
                                </div>
                                <h2 class="text-xs sm:text-sm text-center tracking-wide text-gray-300 font-medium">{{ track.artists.at(0)?.name }}</h2>
                            </div>
                        </div>
                    </swiper-slide>
                } @empty {
                    <p>No tracks found</p>
                }
            </swiper-container>

            <!-- Mobile Navigation Buttons (visible only on mobile) -->
            <div class="sm:hidden flex items-center justify-center gap-4 mt-4">
                <button
                    (click)="slidePrev()"
                    class="p-3 rounded-full bg-emerald-600/20 hover:bg-emerald-600/30 border border-emerald-500/50 transition-all duration-200 active:scale-95"
                    aria-label="Previous slide"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 text-emerald-400">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                    </svg>
                </button>
                <button
                    (click)="slideNext()"
                    class="p-3 rounded-full bg-emerald-600/20 hover:bg-emerald-600/30 border border-emerald-500/50 transition-all duration-200 active:scale-95"
                    aria-label="Next slide"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 text-emerald-400">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
}

@if (isTrackModalOpen()) {
    <app-track-modal
        [track]="selectedTrack()"
        [nextTracks]="[nextTrack()]"
        [previousTracks]="[previousTrack()]"
        (modalClosed)="closeTrackModal()"
        (nextTrackRequested)="onNextTrackRequested()"
        (previousTrackRequested)="onPreviousTrackRequested()"
    ></app-track-modal>
}

<app-mini-player
    [isModalOpen]="isTrackModalOpen()"
    [nextTrackUri]="nextTrack()?.uri || null"
    (trackClicked)="onMiniPlayerClicked()"
></app-mini-player>
